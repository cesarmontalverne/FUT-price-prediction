---
title: "Final"
author: "cesar"
date: "2023-01-06"
output: slidy_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r}
library(plotly)
library(ggplot2)
library(gridExtra)
load("workdata.RData")
```

# Explanatory Data Analysis
```{r}
naPercentage <- function(col_name){
  return(sum(is.na(players_read[,col_name]))/nrow(players_read))
}
nas <- c("xbox_min", "xbox_last", "xbox_max", "ps4_min","ps4_last", "ps4_max", "pc_min","pc_last", "pc_max")
price_nas <- data.frame(nas = nas, console = rep(c("xbox","ps4", "pc"), each=3), type = rep(c("min", "last", "max"), times=3))
price_nas[,1] <- sapply(price_nas[,1],naPercentage)
target_nas <- plot_ly(price_nas, x = ~console, y=~nas, color = ~type,type="bar")
target_nas <- target_nas %>% layout(yaxis = list(title = 'Percentage'), title = "Percentage Nulls per Console", barmode = 'group')
target_nas
```
```{r}
cluster_vis <- function(df){ plot_ly(data = df, x = ~overall, y = ~ps4_last, color=~clusterNum)}
players_price_points <- plot_ly(data = players, x = ~overall, y = ~ps4_last, trace="scatter")
players_price_points
```
```{r}
players_temp <- players_read[!is.na(players_read$ps4_last),]
players_temp <- players_temp %>% filter(position!="GK") %>% group_by(league) %>% 
  dplyr::summarise(avg_pace = sum(pace)/n(), avg_shooting = sum(shooting)/n(), avg_ps4 = sum(ps4_last)/n(),
            avg_def = sum(defending)/n(), avg_age = sum(age)/n(), count =n()) 
players_temp <- players_temp[order(players_temp$avg_ps4, decreasing =TRUE),]
normalize <- function(x){
 (x - min(x)) / (max(x) - min(x))
}
players_temp[,c(2:7)] <- lapply(players_temp[,c(2:7)], normalize)

players_temp[,c(2:7)] <- lapply(players_temp[,c(2:7)], normalize)
league_stats <- plot_ly(players_temp[1:4,], x = ~league, y=~avg_ps4, type="bar", name="avg ps4_price")
league_stats <- league_stats %>% add_trace(y = ~avg_pace, name = 'avg pace', type = "bar")
league_stats <- league_stats %>% add_trace(y = ~avg_shooting, name = 'avg shooting', type = "bar")
league_stats <- league_stats %>% add_trace(y = ~avg_def, name = 'avg defending', type = "bar")
league_stats <- league_stats %>% add_trace(y = ~avg_age, name = 'avg age', type = "bar")
league_stats <- league_stats %>% add_trace(y = ~count, name = 'count', type = "bar")
league_stats <- league_stats %>% layout(yaxis = list(title = 'Normalized Value'), title = "Normalized Stats of 4 Most Expensive Leagues", barmode = 'group')
league_stats

```
We compared leagues and plotted averages for the four most expensive leagues in fifa. Observe how icons is superior in almost everything, and absolutely dwarfs every other league's normalized average price
# Method
tried rfs.
weren't satisfied
```{r}
grid.arrange(keeper_elbow,defender_elbow,midfielder_elbow,attacker_elbow)
```
tried to cluster, as a means to remove outliers
```{r}

keeper_outliers <- keeper_cluster %>% group_by(clusterNum) %>% dplyr::summarise(count=n())
defenders_outliers <- defender_cluster %>% group_by(clusterNum) %>% dplyr::summarise(count=n())
midfielders_outliers <- midfielder_cluster %>% group_by(clusterNum) %>% dplyr::summarise(count=n())
attackers_outliers <- attacker_cluster %>% group_by(clusterNum) %>% dplyr::summarise(count=n())
knitr::kable(keeper_outliers, caption="keeper")
knitr::kable(defenders_outliers, caption="defender")
knitr::kable(midfielders_outliers, caption="midfielder")
knitr::kable(attackers_outliers, caption="attacker")

```
```{r}
cluster_vis(keeper_cluster)
cluster_vis(defender_cluster)
cluster_vis(midfielder_cluster)
cluster_vis(attacker_cluster)
```

# Results
```{r}
results <- data.frame(model=c("before","after"), keeper = c(b_keepers_rmse, keepers_rmse), defender = c(b_defenders_rmse,defenders_rmse),
                      midfielders = c(b_midfielders_rmse, midfielders_rmse), attackers = c(b_attackers_rmse, attackers_rmse))
knitr::kable(results, caption="Results")
```